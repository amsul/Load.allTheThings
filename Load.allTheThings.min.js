/*!
    Load.allTheThings v0.7.2 - 12 September, 2012

    (c) Amsul Naeem, 2012 - http://amsul.ca
    Licensed under MIT ("expat" flavour) license.
    Hosted on http://github.com/amsul/Load.allTheThings

    This library creates a Load object which can be used to
    preload things before they are needed on your page. It can
    load images, fonts, stylesheets, scripts, and html.

    To invoke the loader, use Load.allTheThings()
    For more documentation, check http://github.com/amsul/Load.allTheThings


    * Note: Load.fonts is required to load fonts (http://github.com/amsul/Load.fonts)
*/
(function(){var b,a={}.hasOwnProperty;b=(function(){var e,c;function d(){}window.Load=d;c={};e={get:function(f){if(f&&typeof f==="string"){if(f.match(/^#/)){return document.getElementById(f.replace(/^#/,""))}else{if(f.match(/^\./)){return document.getElementsByClassName(f.replace(/^\./,""))}else{return document.querySelectorAll(f)}}}return null}};d.allTheThings=function(f){c.beginLoading(f);return d};c.beginLoading=function(f){var h,g,j,i;c.PROGRESS=0;c.THINGS=0;c.THINGS_LOADED=0;f=f||{};d.options=f;c.defaults={thingsToLoad:["images","fonts","css","js","html","data"],within:null,progressId:null,progressBarId:null,thingsId:null,thingsLoadedId:null,cleanUp:false,onError:function(k){return d},onLoad:function(k){return d},onComplete:function(){return d}};i=c.defaults;for(g in i){if(!a.call(i,g)){continue}j=i[g];d.options[g]=f[g]||j}if(d.options.thingsToLoad.indexOf("fonts"!==-1)){if(!window.Font||!window.Font.prototype.isLoadDotFonts){throw"Load.fonts (http://github.com/amsul/Load.fonts) is required for Load.allTheThings to work with fonts."}}d.elemProgress=e.get("#"+d.options.progressId);d.elemProgressBar=e.get("#"+d.options.progressBarId);d.elemThings=e.get("#"+d.options.thingsId);d.elemThingsLoaded=e.get("#"+d.options.thingsLoadedId);if(d.elemThingsLoaded){d.elemThingsLoaded.innerHTML=c.THINGS_LOADED}if(d.elemProgress){d.elemProgress.innerHTML=c.PROGRESS}h=(function(){var k;k=e.get(d.options.within);return k||document})();if(h){c.loadAllThingsWithin(h)}if(d.elemThings){d.elemThings.innerHTML=c.THINGS}if(d.elemProgressBar){d.elemProgressBar.style.width=0+"%"}return c};c.loadAllThingsWithin=function(h){var k,f,i,m,n,l,j,o,g;k=[];f=[];if(h.constructor.name==="NodeList"){for(l=0,o=h.length;l<o;l++){i=h[l];k.push(i)}}else{k.push(h)}m=d.options.thingsToLoad;m=typeof m==="string"?[m]:m;for(j=0,g=m.length;j<g;j++){n=m[j];c.findThings(k,f,n)}c.THINGS+=f.length;return c};c.findThings=function(g,n,l){var f,i,j,h,k,m;f=function(s,q){var p,r,o;for(r=0,o=s.length;r<o;r++){p=s[r];if(p.dataset&&p.dataset.src){c.load(p,q);n.push(p)}}return c};j=(function(){switch(l){case"images":return"img";case"fonts":return"font";case"css":return"link";case"js":return"script";case"html":return"section";case"data":return"code";default:throw"Thing type '"+l+"' is unknown"}})();for(k=0,m=g.length;k<m;k++){i=g[k];h=i.querySelectorAll(j);if(h.length){f(h,l)}}return c};c.load=function(g,h){var f,i;if(h==="fonts"){f=new Font();c.addHandlers(f,h);f.fontFamily=g.dataset.family;f.src=g.dataset.src}else{i=g.dataset.src;c.addHandlers(g,h);if(h==="css"){g.href=i}else{g.src=i}}c.doCleanUp(g,h);return c};c.doCleanUp=function(f,g){f.removeAttribute("data-src");if(g==="data"||g==="fonts"){if(d.options.cleanUp){f.outerHTML=""}else{f.style.display="none"}}return c};c.thingLoaded=function(f,g,h){c.THINGS_LOADED+=1;c.PROGRESS=c.THINGS_LOADED/c.THINGS*100;if(d.elemProgress){d.elemProgress.innerHTML=c.PROGRESS}if(d.elemProgressBar){d.elemProgressBar.style.width=c.PROGRESS+"%"}if(d.elemThingsLoaded){d.elemThingsLoaded.innerHTML=c.THINGS_LOADED}if(g==="html"){f.innerHTML=h.responseText}else{if(g==="data"){c.addToCache(f,g,h.responseText)}}d.options.onLoad(f,g);if(c.THINGS_LOADED===c.THINGS){c.loadComplete()}return c};c.loadComplete=function(){d.options.onComplete();return c};c.bind=function(f,h,g){f.addEventListener(h,g,false);return c};c.unbind=function(f,h,g){f.removeEventListener(h,g);return c};c.addHandlers=function(f,h){var j,g,i;if(h==="images"||h==="css"||h==="js"){c.commonHandlers(f,h)}else{if(h==="fonts"){g=function(){c.removeHandlers(f,h).thingLoaded(f,h)};j=function(){c.removeHandlers(f,h);d.options.onError(f,h)};f.onload=g;f.onerror=j}else{if(h==="html"||h==="data"){i=new XMLHttpRequest();i.onload=function(k){c.removeHandlers(i,h).thingLoaded(f,h,i)};i.onreadystatechange=function(k){if(i.readyState===4&&i.status===200){c.removeHandlers(i,h).thingLoaded(f,h,i)}};i.onerror=function(){c.removeHandlers(i,h)};i.open("GET",f.dataset.src,true);i.send()}else{console.log("no add handler",f,h)}}}return c};c.removeHandlers=function(f,g){if(g==="images"||g==="css"||g==="js"){c.unbind(f,"load",f.onLoad).unbind(f,"readyStateChange",f.onReadyStateChange).unbind(f,"error",f.onError)}else{if(g==="fonts"){f.onload=function(){};f.onerror=function(){}}else{if(g==="html"||g==="data"){f.onload=function(){};f.onreadystatechange=function(){};f.onerror=function(){}}else{console.log("no remove handler",f,g)}}}return c};c.commonHandlers=function(g,i){var j,h,f;h=function(k){c.removeHandlers(g,i).thingLoaded(g,i)};f=function(k){if(g.readyState==="complete"){c.removeHandlers(g,i).thingLoaded(g,i)}};j=function(k){c.removeHandlers(g,i);d.options.onError(g,i)};c.bind(g,"load",h).bind(g,"readyStateChange",f).bind(g,"error",j);return c};c.addToCache=function(f,g,i){var h;c.cache=c.cache||{};if(g==="data"){h=JSON.parse(i);if(f.dataset&&f.dataset.name){c.cache[f.dataset.name]=h}else{throw"No name given to this type '"+g+"'"}}return c};d.getCached=function(g){var f;f=c.cache[g];if(f){return f}};return d})()}).call(this);